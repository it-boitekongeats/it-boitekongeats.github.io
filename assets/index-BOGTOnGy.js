(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const j=(e,o)=>{let t=new WebSocket(e);return t.onopen=()=>{console.log("WebSocket connection established")},t.onmessage=r=>{const n=JSON.parse(r.data);o(n)},t.onclose=()=>{console.log("WebSocket connection closed")},t.onerror=r=>{console.error("WebSocket error:",r)},{socket:t,closeWebSocket:()=>{t&&t.close()}}},q="wss://b-town-bites.onrender.com",f="https://b-town-bites.onrender.com",I=async(e=sessionStorage.getItem("cookId"))=>{const o=sessionStorage.getItem("token"),t=await fetch(`${f}/orders/by-cook`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({cookId:e})});return t.ok?t.json():{error:(await t.json()).message||"An error occurred"}},H=async(e,o)=>{const t=sessionStorage.getItem("token"),s=await fetch(`${f}/orders/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)});if(!s.ok)throw new Error("Failed to update order");return s.json()},W=async(e,o)=>{e=e.toLocaleLowerCase();try{const t=await fetch(`${f}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,pin:o})}),s=await t.json();if(!t.ok)throw new Error(s.error||"Failed to log in");return s.token&&(sessionStorage.setItem("token",s.token),sessionStorage.setItem("cookId",e)),s}catch{throw new Error("Failed to log in. Please try again.")}},_=async()=>{try{const e=sessionStorage.getItem("token"),o=await fetch(`${f}/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`}}),t=await o.json();if(!o.ok)throw new Error(t.error||"Failed to logout");return sessionStorage.removeItem("token"),sessionStorage.removeItem("cookId"),t}catch(e){throw new Error(e.message||"Failed to logout")}},P=(e=!1)=>{const o=document.createElement("div");o.className="loading-container";const t=document.createElement("div");t.className="spinner",o.appendChild(t);const s=r=>{sessionStorage.setItem("isLoading",r.toString()),r?document.body.contains(o)||document.body.appendChild(o):document.body.contains(o)&&document.body.removeChild(o)};return sessionStorage.getItem("isLoading"),{toggleLoadingSpinner:s}},v=(e=2e3,o=()=>{console.log("refesh page")})=>{setTimeout(()=>{o(),location.reload()},e)},k=(e,o,t,s=!1)=>{const r=document.createElement("label");r.textContent=e;const n=document.createElement("input");return n.type=o,n.name=t,s&&(n.required=!0),r.appendChild(n),{label:r,input:n}},w=(e,o)=>{const t=document.createElement("div");t.className="detail-group";const s=document.createElement("span");s.className="new-detail-label",s.textContent=e;const r=document.createElement("span");r.className="new-detail-value";const n=document.createElement("button");return n.type="button",n.textContent=o,t.appendChild(s),t.appendChild(r),t.appendChild(n),{detailGroup:t,valueSpan:r,copyButton:n}},G=()=>{const e=document.createElement("form");e.className="login-form";const{label:o,input:t}=k("Name:","text","username",!0);e.appendChild(o);const{label:s,input:r}=k("Pin:","password","pin",!0);e.appendChild(s);const n=document.createElement("button");n.type="submit",n.id="login-btn",n.textContent="Login",e.appendChild(n);const a=document.createElement("button");a.type="button",a.className="mode-toggle",a.textContent="Signup",a.disabled=!0;const l=document.createElement("p");l.className="login-message",e.appendChild(l);const i=document.createElement("div");i.className="new-login-details",i.style.display="none";const c=document.createElement("p");c.textContent="Here are your new login details:",i.appendChild(c);const{detailGroup:d,valueSpan:p,copyButton:b}=w("NAME: ","ðŸ“‹ Copy");i.appendChild(d);const{detailGroup:D,valueSpan:S,copyButton:R}=w("PIN: ","ðŸ“‹ Copy");i.appendChild(D),e.appendChild(i);const{toggleLoadingSpinner:N}=P();let u=!0;a.onclick=()=>{u=!u,n.textContent=u?"Login":"Signup",a.textContent=u?"Signup":"Login",r.required=u,s.style.display=u?"block":"none",r.style.display=u?"block":"none",i.style.display="none"};const L=y=>{navigator.clipboard.writeText(y).then(()=>{l.textContent="Copied to clipboard!",l.classList.add("success"),v(2e3,()=>l.textContent="")}).catch(E=>console.error("Could not copy text:",E))};return b.onclick=()=>L(p.textContent),R.onclick=()=>L(S.textContent),e.onsubmit=async y=>{N(!0),y.preventDefault();const E=t.value,F=r.value;try{const m=u?await W(E,F):(alert("You're not authorized!"),"Not Allowed");m.message&&(l.textContent=m.message,l.classList.add("success"),l.classList.remove("error"),v(),!u&&m.username&&m.pin&&(p.textContent=m.username,S.textContent=m.pin,i.style.display="block"))}catch(m){l.textContent=m.message||`Failed to ${u?"log in":"sign up"}. Please try again.`,l.classList.add("error"),l.classList.remove("success")}finally{N(!1)}},e};function h(e,o=!0){if(document.getElementById("customAlert"))return;const t=document.createElement("div");t.classList.add("alert-backdrop");const s=document.createElement("div");s.id="customAlert",s.classList.add("alert-container");const r=document.createElement("p");r.innerText=e,s.appendChild(r);const n=document.createElement("button");n.innerText="OK",n.classList.add("ok-button"),n.addEventListener("click",function(){document.body.removeChild(s),document.body.removeChild(t),o&&location.reload()}),s.appendChild(n),document.body.appendChild(t),document.body.appendChild(s)}const g=async(e,o)=>{console.log(o);try{const t=e._id,s={...e,status:o},r=await H(t,s);r!=null&&r.alert?h(r.alert):location.reload()}catch(t){console.error("Error updating order status:",t)}},U=e=>{const o=new Date(e.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),t=document.createElement("article");t.className="order-item",[{label:"Order",value:e.orderNumber,className:"order-detail-order-number"},{label:"Name",value:e.name,className:"order-detail-name"},{label:"Phone",value:e.phone,className:"order-detail-phone"},{label:"Street Address",value:e.streetAddress,className:"order-detail-address"},{label:"House Number",value:e.houseNumber,className:"order-detail-house-number"},{label:"Payment Method",value:e.paymentMethod,className:"order-detail-payment-method"},{label:"Delivery Charge",value:`R${e.deliveryCharge}.00`,className:"order-detail-delivery-charge"},{label:"Payment Items",value:e.paymentItemsDescriptions,className:"order-detail-payment-items"},{label:"Timestamp",value:o,className:"order-detail-timestamp"},{label:"Payment Total",value:`R${e.paymentTotal}.00`,className:"order-detail-payment-total"},{label:"Chef",value:e.cookId.join(", "),className:"order-detail-cook-id"}].forEach(n=>{const a=document.createElement("p");a.textContent=`${n.label}: ${n.value}`,a.className=`order-detail ${n.className}`,t.appendChild(a)});const r=document.createElement("p");if(r.className="status-text",r.textContent=`Status: ${e.status}`,t.appendChild(r),e.status==="Pending"){const n=document.createElement("button");n.textContent="Move to Process",n.className="process-button",n.addEventListener("click",()=>g(e,"Process")),t.appendChild(n)}if(e.status==="Process"){const n=document.createElement("button");n.textContent="Fulfill Order",n.className="fulfill-button",n.addEventListener("click",()=>g(e,"Ready")),t.appendChild(n)}if(e.status==="Cancelled"){const n=document.createElement("button");n.textContent="Reinstate to Pending",n.className="reinstate-pending-button",n.addEventListener("click",()=>g(e,"Pending")),t.appendChild(n);const a=document.createElement("button");a.textContent="Reinstate to Process",a.className="reinstate-process-button",a.addEventListener("click",()=>g(e,"Process")),t.appendChild(a)}if(e.status!=="Ready"&&e.status!=="Cancelled"){const n=document.createElement("button");n.textContent="Cancel Order",n.className="cancel-button",n.addEventListener("click",()=>g(e,"Cancelled")),t.appendChild(n)}return t},x=(e,o)=>{o.innerHTML="",e.reverse().forEach(t=>{const s=U(t);o.appendChild(s)})},O=(e,o)=>{const t=document.querySelector(".order-filter-container");t&&t.remove();const s=document.createElement("div");s.className="order-filter-container";const r=["All","Process","Ready","Pending","Cancelled"],n={Ready:e.filter(a=>a.status.toLowerCase()==="ready").length,Process:e.filter(a=>a.status.toLowerCase()==="process").length,Pending:e.filter(a=>a.status.toLowerCase()==="pending").length,Cancelled:e.filter(a=>a.status.toLowerCase()==="cancelled").length,All:e.length};r.forEach(a=>{const l=document.createElement("button");l.textContent=`${a} (${n[a]})`,l.className=`filter-button filter-${a.toLowerCase()}`,l.addEventListener("click",()=>{const{toggleLoadingSpinner:i}=P();i(!0),setTimeout(()=>{const c=a==="All"?e:e.reverse().filter(d=>d.status.toLowerCase()===a.toLowerCase());x(c,o),i(!1)},2e3)}),s.appendChild(l)}),o.parentElement.insertBefore(s,o),x(e,o)};document.addEventListener("DOMContentLoaded",async()=>{const e=document.body;if(!sessionStorage.getItem("token")){const c=G();e.innerHTML="",e.appendChild(c);return}const t=e.querySelector("#order-list"),s=e.querySelector("#order-stats");if(!t||!s){console.error("Required DOM elements are missing.");return}let r=[];const n=new Set;j(q,c=>{const d={connected:()=>console.log(c.message),newOrder:()=>{n.has(c.order._id)||(r.push(c.order),n.add(c.order._id))},updateOrder:()=>{const p=r.findIndex(b=>b._id===c.order._id);p!==-1&&(r[p]=c.order)},deleteOrder:()=>{r=r.filter(p=>p._id!==c.orderId)},newSignup:()=>console.log(c.user),userLogin:()=>console.log(c.user),userLogout:()=>console.log(c.user),smsSent:()=>console.log(c.info),smsFailed:()=>console.log(c.info),smsError:()=>console.log(c.info)};c.channel&&console.log(`Received message on channel: ${c.channel}`),d[c.type],O(r,t)});const l=c=>{let d=document.querySelector(".error-message");d||(d=document.createElement("p"),d.className="error-message",e.appendChild(d)),d.textContent=c},i=()=>{const c=document.querySelector(".error-message");c&&c.remove()};try{i();const c=await I();c.error?(l(c.error),c.error.toLowerCase().includes("no orders found for this cook")||v(3e3,()=>sessionStorage.clear())):(r=c,O(r,t))}catch(c){console.error("Error fetching orders:",c)}});function K(){if(document.getElementById("search-container"))return;const e=document.createElement("div");e.id="backdrop-container";const o=document.createElement("div");o.id="search-container";const t=["Order Number","Name","Phone"],s=document.createElement("select");s.id="search-option",t.forEach(i=>{const c=document.createElement("option");c.value=i.toLowerCase().replace(" ",""),c.text=i,s.appendChild(c)});const r=document.createElement("input");r.id="search-input",r.type="text";const n=document.createElement("button");n.innerText="Search",n.onclick=V;const a=document.createElement("button");a.innerText="X",a.id="search-close-btn",a.onclick=z,o.appendChild(s),o.appendChild(r),o.appendChild(n),o.appendChild(a);const l=document.createElement("div");l.id="result-container",o.appendChild(l),e.appendChild(o),document.body.appendChild(e)}function z(){const e=document.getElementById("backdrop-container");e&&(e.remove(),location.reload())}function J(e){const o=document.getElementById("result-container");if(o.innerHTML="",e.length===0){o.innerHTML="<p>No matching orders found</p>";return}e.forEach(t=>{const s=document.createElement("div");s.className="order-card",s.innerHTML=`
      <p><strong>Order Number:</strong> ${t.orderNumber}</p>
      <p><strong>Name:</strong> ${t.name}</p>
      <p><strong>Phone:</strong> ${t.phone}</p>
      <p><strong>Address:</strong> ${t.houseNumber}, ${t.streetAddress}</p>
      <p><strong>Items:</strong> ${t.paymentItemsDescriptions}</p>
      <p><strong>Total Payment:</strong> R${t.paymentTotal}</p>
      <p><strong>Status:</strong> ${t.status}</p>
    `,o.appendChild(s)})}async function V(){const e=document.getElementById("search-option").value,o=document.getElementById("search-input").value;if(e)if(!o)h(`No ${e} entered!`,!1);else if(["ordernumber","phone"].includes(e)&&isNaN(o)){h("The input must be a number",!1);return}else try{const s=(await I()).filter(n=>{for(const a in n)if(a.replace(/\s+/g,"").toLowerCase()===e&&n[a].toString().toLowerCase().trim()===o.toString().toLowerCase().trim())return!0;return!1}),r=document.getElementById("result-container");if(s.length>0)J(s);else{const n=e==="ordernumber"?"order number":e;r.innerHTML=`<p>No order(s) found matching ${n}: ${o}</p>`}}catch(t){console.error("Error fetching orders:",t)}else{h("No option is selected!",!1);return}}const X=()=>{const e=document.createElement("header");e.className="header-nav";const o=document.createElement("img");o.src="/assets/boitekong_eats_logo.png",o.alt="Boitekong Eats Logo",o.className="logo";const t=document.createElement("h1");t.textContent="Orders Dashboard";const s=document.createElement("div");s.className="header-content",s.appendChild(o),s.appendChild(t);const r=document.createElement("button");r.textContent="Logout",r.className="logout-button",r.onclick=async()=>{r.disabled=!0;try{const l=await _();setTimeout(()=>{r.disabled=!1,location.reload()},2e3)}catch(l){console.error("Logout failed:",l),r.disabled=!1}},s.appendChild(r);const n=document.createElement("button");n.textContent="Search Orders",n.className="search-button";let a=!1;return n.onclick=()=>{if(a=!a,a)K();else{const l=document.getElementById("search-container");l&&l.remove()}},s.appendChild(n),e.appendChild(s),e},T=(e,o={})=>{const t=document.createElement(e);return Object.assign(t,o),t},C=(e="")=>{const o=T("section");return e&&(o.className=e),o},Y=document.querySelector("#app"),$=C(),Q=X(),Z=T("hr"),B=C("card"),A=C();A.id="order-list";const M=C();M.id="order-stats";B.appendChild(A);$.append(Q,Z,M,B);Y.appendChild($);
