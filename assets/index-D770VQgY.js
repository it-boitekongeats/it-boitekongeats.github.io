(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const F=(e,s)=>{let t=new WebSocket(e);return t.onopen=()=>{console.log("WebSocket connection established")},t.onmessage=o=>{const n=JSON.parse(o.data);s(n)},t.onclose=()=>{console.log("WebSocket connection closed")},t.onerror=o=>{console.error("WebSocket error:",o)},{socket:t,closeWebSocket:()=>{t&&t.close()}}},h="https://b-town-bites.onrender.com",R=async(e=sessionStorage.getItem("cookId"))=>{const s=sessionStorage.getItem("token"),t=await fetch(`${h}/orders/by-cook`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({cookId:e})});return t.ok?t.json():{error:(await t.json()).message||"An error occurred"}},j=async(e,s)=>{const t=sessionStorage.getItem("token"),r=await fetch(`${h}/orders/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update order");return r.json()},q=async(e,s)=>{e=e.toLocaleLowerCase();try{const t=await fetch(`${h}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,pin:s})}),r=await t.json();if(!t.ok)throw new Error(r.error||"Failed to log in");return r.token&&(sessionStorage.setItem("token",r.token),sessionStorage.setItem("cookId",e)),r}catch{throw new Error("Failed to log in. Please try again.")}},W=async()=>{try{const e=sessionStorage.getItem("token"),s=await fetch(`${h}/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`}}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to logout");return sessionStorage.removeItem("token"),sessionStorage.removeItem("cookId"),t}catch(e){throw new Error(e.message||"Failed to logout")}},O=(e=!1)=>{const s=document.createElement("div");s.className="loading-container";const t=document.createElement("div");t.className="spinner",s.appendChild(t);const r=o=>{sessionStorage.setItem("isLoading",o.toString()),o?document.body.contains(s)||document.body.appendChild(s):document.body.contains(s)&&document.body.removeChild(s)};return sessionStorage.getItem("isLoading"),{toggleLoadingSpinner:r}},S=(e=2e3,s=()=>{console.log("refesh page")})=>{setTimeout(()=>{s(),location.reload()},e)},w=(e,s,t,r=!1)=>{const o=document.createElement("label");o.textContent=e;const n=document.createElement("input");return n.type=s,n.name=t,r&&(n.required=!0),o.appendChild(n),{label:o,input:n}},L=(e,s)=>{const t=document.createElement("div");t.className="detail-group";const r=document.createElement("span");r.className="new-detail-label",r.textContent=e;const o=document.createElement("span");o.className="new-detail-value";const n=document.createElement("button");return n.type="button",n.textContent=s,t.appendChild(r),t.appendChild(o),t.appendChild(n),{detailGroup:t,valueSpan:o,copyButton:n}},_=()=>{const e=document.createElement("form");e.className="login-form";const{label:s,input:t}=w("Name:","text","username",!0);e.appendChild(s);const{label:r,input:o}=w("Pin:","password","pin",!0);e.appendChild(r);const n=document.createElement("button");n.type="submit",n.id="login-btn",n.textContent="Login",e.appendChild(n);const c=document.createElement("button");c.type="button",c.className="mode-toggle",c.textContent="Signup",c.disabled=!0;const l=document.createElement("p");l.className="login-message",e.appendChild(l);const i=document.createElement("div");i.className="new-login-details",i.style.display="none";const a=document.createElement("p");a.textContent="Here are your new login details:",i.appendChild(a);const{detailGroup:d,valueSpan:p,copyButton:y}=L("NAME: ","ðŸ“‹ Copy");i.appendChild(d);const{detailGroup:A,valueSpan:E,copyButton:D}=L("PIN: ","ðŸ“‹ Copy");i.appendChild(A),e.appendChild(i);const{toggleLoadingSpinner:N}=O();let u=!0;c.onclick=()=>{u=!u,n.textContent=u?"Login":"Signup",c.textContent=u?"Signup":"Login",o.required=u,r.style.display=u?"block":"none",o.style.display=u?"block":"none",i.style.display="none"};const v=C=>{navigator.clipboard.writeText(C).then(()=>{l.textContent="Copied to clipboard!",l.classList.add("success"),S(2e3,()=>l.textContent="")}).catch(b=>console.error("Could not copy text:",b))};return y.onclick=()=>v(p.textContent),D.onclick=()=>v(E.textContent),e.onsubmit=async C=>{N(!0),C.preventDefault();const b=t.value,M=o.value;try{const m=u?await q(b,M):(alert("You're not authorized!"),"Not Allowed");m.message&&(l.textContent=m.message,l.classList.add("success"),l.classList.remove("error"),S(),!u&&m.username&&m.pin&&(p.textContent=m.username,E.textContent=m.pin,i.style.display="block"))}catch(m){l.textContent=m.message||`Failed to ${u?"log in":"sign up"}. Please try again.`,l.classList.add("error"),l.classList.remove("success")}finally{N(!1)}},e},g=async(e,s)=>{try{const t=e._id,r={...e,status:s},o=await j(t,r);s==="Ready"&&alert(`Order ready & notification via SMS is sent to the customer at ${o.phone}`),console.log(o)}catch(t){console.error("Error updating order status:",t)}},G=e=>{const s=new Date(e.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),t=document.createElement("article");t.className="order-item",[{label:"Order",value:e.orderNumber,className:"order-detail-order-number"},{label:"Name",value:e.name,className:"order-detail-name"},{label:"Phone",value:e.phone,className:"order-detail-phone"},{label:"Street Address",value:e.streetAddress,className:"order-detail-address"},{label:"House Number",value:e.houseNumber,className:"order-detail-house-number"},{label:"Payment Method",value:e.paymentMethod,className:"order-detail-payment-method"},{label:"Delivery Charge",value:`R${e.deliveryCharge}.00`,className:"order-detail-delivery-charge"},{label:"Payment Items",value:e.paymentItemsDescriptions,className:"order-detail-payment-items"},{label:"Timestamp",value:s,className:"order-detail-timestamp"},{label:"Payment Total",value:`R${e.paymentTotal}.00`,className:"order-detail-payment-total"},{label:"Chef",value:e.cookId.join(", "),className:"order-detail-cook-id"}].forEach(n=>{const c=document.createElement("p");c.textContent=`${n.label}: ${n.value}`,c.className=`order-detail ${n.className}`,t.appendChild(c)});const o=document.createElement("p");if(o.className="status-text",o.textContent=`Status: ${e.status}`,t.appendChild(o),e.status==="Pending"){const n=document.createElement("button");n.textContent="Move to Process",n.className="process-button",n.addEventListener("click",()=>g(e,"Process")),t.appendChild(n)}if(e.status==="Process"){const n=document.createElement("button");n.textContent="Fulfill Order",n.className="fulfill-button",n.addEventListener("click",()=>g(e,"Ready")),t.appendChild(n)}if(e.status==="Cancelled"){const n=document.createElement("button");n.textContent="Reinstate to Pending",n.className="reinstate-pending-button",n.addEventListener("click",()=>g(e,"Pending")),t.appendChild(n);const c=document.createElement("button");c.textContent="Reinstate to Process",c.className="reinstate-process-button",c.addEventListener("click",()=>g(e,"Process")),t.appendChild(c)}if(e.status!=="Ready"&&e.status!=="Cancelled"){const n=document.createElement("button");n.textContent="Cancel Order",n.className="cancel-button",n.addEventListener("click",()=>g(e,"Cancelled")),t.appendChild(n)}return t},k=(e,s)=>{s.innerHTML="",e.forEach(t=>{const r=G(t);s.appendChild(r)})},x=(e,s)=>{const t=document.querySelector(".order-filter-container");t&&t.remove();const r=document.createElement("div");r.className="order-filter-container";const o=["All","Process","Ready","Pending","Cancelled"],n={Ready:e.filter(c=>c.status.toLowerCase()==="ready").length,Process:e.filter(c=>c.status.toLowerCase()==="process").length,Pending:e.filter(c=>c.status.toLowerCase()==="pending").length,Cancelled:e.filter(c=>c.status.toLowerCase()==="cancelled").length,All:e.length};o.forEach(c=>{const l=document.createElement("button");l.textContent=`${c} (${n[c]})`,l.className=`filter-button filter-${c.toLowerCase()}`,l.addEventListener("click",()=>{const{toggleLoadingSpinner:i}=O();i(!0),setTimeout(()=>{const a=c==="All"?e:e.filter(d=>d.status.toLowerCase()===c.toLowerCase());k(a,s),i(!1)},2e3)}),r.appendChild(l)}),s.parentElement.insertBefore(r,s),k(e,s)},H="wss://b-town-bites.onrender.com";document.addEventListener("DOMContentLoaded",async()=>{const e=document.body;if(!sessionStorage.getItem("token")){const a=_();e.innerHTML="",e.appendChild(a);return}const t=e.querySelector("#order-list"),r=e.querySelector("#order-stats");if(!t||!r){console.error("Required DOM elements are missing.");return}let o=[];const n=new Set;F(H,a=>{const d={connected:()=>console.log(a.message),newOrder:()=>{n.has(a.order._id)||(o.push(a.order),n.add(a.order._id))},updateOrder:()=>{const p=o.findIndex(y=>y._id===a.order._id);p!==-1&&(o[p]=a.order)},deleteOrder:()=>{o=o.filter(p=>p._id!==a.orderId)},newSignup:()=>console.log(a.user),userLogin:()=>console.log(a.user),userLogout:()=>console.log(a.user),smsSent:()=>console.log(a.info),smsFailed:()=>console.log(a.info),smsError:()=>console.log(a.info)};a.channel&&console.log(`Received message on channel: ${a.channel}`),d[a.type],x(o,t)});const l=a=>{let d=document.querySelector(".error-message");d||(d=document.createElement("p"),d.className="error-message",e.appendChild(d)),d.textContent=a},i=()=>{const a=document.querySelector(".error-message");a&&a.remove()};try{i();const a=await R();a.error?(l(a.error),a.error.toLowerCase().includes("no orders found for this cook")||S(3e3,()=>sessionStorage.clear())):(o=a,x(o,t))}catch(a){console.error("Error fetching orders:",a)}});const U=()=>{const e=document.createElement("header");e.className="header-nav";const s=document.createElement("img");s.src="/assets/boitekong_eats_logo.png",s.alt="Boitekong Eats Logo",s.className="logo";const t=document.createElement("h1");t.textContent="Orders Dashboard";const r=document.createElement("div");r.className="header-content",r.appendChild(s),r.appendChild(t);const o=document.createElement("button");return o.textContent="Logout",o.className="logout-button",o.onclick=async()=>{o.disabled=!0;try{const n=await W();setTimeout(()=>{o.disabled=!1,location.reload()},2e3)}catch(n){console.error("Logout failed:",n),o.disabled=!1}},r.appendChild(o),e.appendChild(r),e},P=(e,s={})=>{const t=document.createElement(e);return Object.assign(t,s),t},f=(e="")=>{const s=P("section");return e&&(s.className=e),s},z=document.querySelector("#app"),I=f(),J=U(),K=P("hr"),$=f("card"),T=f();T.id="order-list";const B=f();B.id="order-stats";$.appendChild(T);I.append(J,K,B,$);z.appendChild(I);
