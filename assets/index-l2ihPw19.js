(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const F=(e,s)=>{let t=new WebSocket(e);return t.onopen=()=>{console.log("WebSocket connection established")},t.onmessage=o=>{const n=JSON.parse(o.data);s(n)},t.onclose=()=>{console.log("WebSocket connection closed")},t.onerror=o=>{console.error("WebSocket error:",o)},{socket:t,closeWebSocket:()=>{t&&t.close()}}},f="https://b-town-bites.onrender.com",R=async(e=sessionStorage.getItem("cookId"))=>{const s=sessionStorage.getItem("token"),t=await fetch(`${f}/orders/by-cook`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({cookId:e})});return t.ok?t.json():{error:(await t.json()).message||"An error occurred"}},j=async(e,s)=>{const t=sessionStorage.getItem("token"),r=await fetch(`${f}/orders/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update order");return r.json()},q=async(e,s)=>{e=e.toLocaleLowerCase();try{const t=await fetch(`${f}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,pin:s})}),r=await t.json();if(!t.ok)throw new Error(r.error||"Failed to log in");return r.token&&(sessionStorage.setItem("token",r.token),sessionStorage.setItem("cookId",e)),r}catch{throw new Error("Failed to log in. Please try again.")}},W=async()=>{try{const e=sessionStorage.getItem("token"),s=await fetch(`${f}/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`}}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to logout");return sessionStorage.removeItem("token"),sessionStorage.removeItem("cookId"),t}catch(e){throw new Error(e.message||"Failed to logout")}},O=(e=!1)=>{const s=document.createElement("div");s.className="loading-container";const t=document.createElement("div");t.className="spinner",s.appendChild(t);const r=o=>{sessionStorage.setItem("isLoading",o.toString()),o?document.body.contains(s)||document.body.appendChild(s):document.body.contains(s)&&document.body.removeChild(s)};return sessionStorage.getItem("isLoading"),{toggleLoadingSpinner:r}},E=(e=2e3,s=()=>{console.log("refesh page")})=>{setTimeout(()=>{s(),location.reload()},e)},L=(e,s,t,r=!1)=>{const o=document.createElement("label");o.textContent=e;const n=document.createElement("input");return n.type=s,n.name=t,r&&(n.required=!0),o.appendChild(n),{label:o,input:n}},k=(e,s)=>{const t=document.createElement("div");t.className="detail-group";const r=document.createElement("span");r.className="new-detail-label",r.textContent=e;const o=document.createElement("span");o.className="new-detail-value";const n=document.createElement("button");return n.type="button",n.textContent=s,t.appendChild(r),t.appendChild(o),t.appendChild(n),{detailGroup:t,valueSpan:o,copyButton:n}},_=()=>{const e=document.createElement("form");e.className="login-form";const{label:s,input:t}=L("Name:","text","username",!0);e.appendChild(s);const{label:r,input:o}=L("Pin:","password","pin",!0);e.appendChild(r);const n=document.createElement("button");n.type="submit",n.id="login-btn",n.textContent="Login",e.appendChild(n);const a=document.createElement("button");a.type="button",a.className="mode-toggle",a.textContent="Signup",a.disabled=!0;const l=document.createElement("p");l.className="login-message",e.appendChild(l);const i=document.createElement("div");i.className="new-login-details",i.style.display="none";const c=document.createElement("p");c.textContent="Here are your new login details:",i.appendChild(c);const{detailGroup:d,valueSpan:h,copyButton:p}=k("NAME: ","ðŸ“‹ Copy");i.appendChild(d);const{detailGroup:C,valueSpan:N,copyButton:D}=k("PIN: ","ðŸ“‹ Copy");i.appendChild(C),e.appendChild(i);const{toggleLoadingSpinner:v}=O();let u=!0;a.onclick=()=>{u=!u,n.textContent=u?"Login":"Signup",a.textContent=u?"Signup":"Login",o.required=u,r.style.display=u?"block":"none",o.style.display=u?"block":"none",i.style.display="none"};const w=b=>{navigator.clipboard.writeText(b).then(()=>{l.textContent="Copied to clipboard!",l.classList.add("success"),E(2e3,()=>l.textContent="")}).catch(S=>console.error("Could not copy text:",S))};return p.onclick=()=>w(h.textContent),D.onclick=()=>w(N.textContent),e.onsubmit=async b=>{v(!0),b.preventDefault();const S=t.value,M=o.value;try{const m=u?await q(S,M):(alert("You're not authorized!"),"Not Allowed");m.message&&(l.textContent=m.message,l.classList.add("success"),l.classList.remove("error"),E(),!u&&m.username&&m.pin&&(h.textContent=m.username,N.textContent=m.pin,i.style.display="block"))}catch(m){l.textContent=m.message||`Failed to ${u?"log in":"sign up"}. Please try again.`,l.classList.add("error"),l.classList.remove("success")}finally{v(!1)}},e},g=async(e,s)=>{try{const t=e._id,r={...e,status:s},o=await j(t,r);s==="Ready"&&alert(`Order ready & notification via SMS is sent to the customer at ${o.phone}`),console.log(o)}catch(t){console.error("Error updating order status:",t)}},G=e=>{const s=new Date(e.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),t=document.createElement("article");t.className="order-item",[{label:"Name",value:e.name,className:"order-detail-name"},{label:"Phone",value:e.phone,className:"order-detail-phone"},{label:"Street Address",value:e.streetAddress,className:"order-detail-address"},{label:"House Number",value:e.houseNumber,className:"order-detail-house-number"},{label:"Payment Method",value:e.paymentMethod,className:"order-detail-payment-method"},{label:"Delivery Charge",value:`R${e.deliveryCharge}.00`,className:"order-detail-delivery-charge"},{label:"Payment Items",value:e.paymentItemsDescriptions,className:"order-detail-payment-items"},{label:"Timestamp",value:s,className:"order-detail-timestamp"},{label:"Payment Total",value:`R${e.paymentTotal}.00`,className:"order-detail-payment-total"},{label:"Chef",value:e.cookId.join(", "),className:"order-detail-cook-id"}].forEach(n=>{const a=document.createElement("p");a.textContent=`${n.label}: ${n.value}`,a.className=`order-detail ${n.className}`,t.appendChild(a)});const o=document.createElement("p");if(o.className="status-text",o.textContent=`Status: ${e.status}`,t.appendChild(o),e.status==="Pending"){const n=document.createElement("button");n.textContent="Move to Process",n.className="process-button",n.addEventListener("click",()=>g(e,"Process")),t.appendChild(n)}if(e.status==="Process"){const n=document.createElement("button");n.textContent="Fulfill Order",n.className="fulfill-button",n.addEventListener("click",()=>g(e,"Ready")),t.appendChild(n)}if(e.status==="Cancelled"){const n=document.createElement("button");n.textContent="Reinstate to Pending",n.className="reinstate-pending-button",n.addEventListener("click",()=>g(e,"Pending")),t.appendChild(n);const a=document.createElement("button");a.textContent="Reinstate to Process",a.className="reinstate-process-button",a.addEventListener("click",()=>g(e,"Process")),t.appendChild(a)}if(e.status!=="Ready"&&e.status!=="Cancelled"){const n=document.createElement("button");n.textContent="Cancel Order",n.className="cancel-button",n.addEventListener("click",()=>g(e,"Cancelled")),t.appendChild(n)}return t},x=(e,s)=>{s.innerHTML="",e.forEach(t=>{const r=G(t);s.appendChild(r)})},P=(e,s)=>{const t=document.querySelector(".order-filter-container");t&&t.remove();const r=document.createElement("div");r.className="order-filter-container";const o=["All","Process","Ready","Pending","Cancelled"],n={Ready:e.filter(a=>a.status.toLowerCase()==="ready").length,Process:e.filter(a=>a.status.toLowerCase()==="process").length,Pending:e.filter(a=>a.status.toLowerCase()==="pending").length,Cancelled:e.filter(a=>a.status.toLowerCase()==="cancelled").length,All:e.length};o.forEach(a=>{const l=document.createElement("button");l.textContent=`${a} (${n[a]})`,l.className=`filter-button filter-${a.toLowerCase()}`,l.addEventListener("click",()=>{const{toggleLoadingSpinner:i}=O();i(!0),setTimeout(()=>{const c=a==="All"?e:e.filter(d=>d.status.toLowerCase()===a.toLowerCase());x(c,s),i(!1)},2e3)}),r.appendChild(l)}),s.parentElement.insertBefore(r,s),x(e,s)},H="wss://b-town-bites.onrender.com";document.addEventListener("DOMContentLoaded",async()=>{const e=document.body;if(!sessionStorage.getItem("token")){const c=_();e.innerHTML="",e.appendChild(c);return}const t=e.querySelector("#order-list"),r=e.querySelector("#order-stats");if(!t||!r){console.error("Required DOM elements are missing.");return}let o=[];const n=new Set;F(H,c=>{const d={connected:()=>console.log(c.message),newOrder:()=>{n.has(c.order._id)||(o.push(c.order),n.add(c.order._id))},updateOrder:()=>{const p=o.findIndex(C=>C._id===c.order._id);p!==-1&&(o[p]=c.order)},deleteOrder:()=>{o=o.filter(p=>p._id!==c.orderId)},newSignup:()=>console.log(c.user),userLogin:()=>console.log(c.user),userLogout:()=>console.log(c.user),smsSent:()=>console.log(c.info),smsFailed:()=>console.log(c.info),smsError:()=>console.log(c.info)};c.channel&&console.log(`Received message on channel: ${c.channel}`);const h=d[c.type];h(),P(o,t)});const l=c=>{let d=document.querySelector(".error-message");d||(d=document.createElement("p"),d.className="error-message",e.appendChild(d)),d.textContent=c},i=()=>{const c=document.querySelector(".error-message");c&&c.remove()};try{i();const c=await R();c.error?(l(c.error),E(3e3,()=>sessionStorage.clear())):(o=c,P(o,t))}catch(c){console.error("Error fetching orders:",c)}});const U=()=>{const e=document.createElement("header");e.className="header-nav";const s=document.createElement("img");s.src="/assets/boitekong_eats_logo.png",s.alt="Boitekong Eats Logo",s.className="logo";const t=document.createElement("h1");t.textContent="Orders Dashboard";const r=document.createElement("div");r.className="header-content",r.appendChild(s),r.appendChild(t);const o=document.createElement("button");return o.textContent="Logout",o.className="logout-button",o.onclick=async()=>{o.disabled=!0;try{const n=await W();setTimeout(()=>{o.disabled=!1,location.reload()},2e3)}catch(n){console.error("Logout failed:",n),o.disabled=!1}},r.appendChild(o),e.appendChild(r),e},I=(e,s={})=>{const t=document.createElement(e);return Object.assign(t,s),t},y=(e="")=>{const s=I("section");return e&&(s.className=e),s},z=document.querySelector("#app"),$=y(),J=U(),K=I("hr"),T=y("card"),B=y();B.id="order-list";const A=y();A.id="order-stats";T.appendChild(B);$.append(J,K,A,T);z.appendChild($);
